# 🚀 智能旅行规划 Agent

一个基于 LangGraph 构建的智能旅行规划 Agent，具备多步骤规划、状态管理和依赖处理能力。该 Agent 能够理解用户的自然语言需求，自动拆解复杂任务，并完成从航班查询到酒店预订的完整旅行规划流程。

## 🎯 设计哲学

### 架构设计理念

本项目采用 **有向图工作流** 架构，基于 LangGraph 框架构建，核心设计理念包括：

1. **状态驱动的执行流程**
   - 使用 `TravelPlanningState` 类型管理整个规划流程的状态
   - 每个节点只关注自己的职责，通过状态传递信息
   - 支持流程的暂停、恢复和错误处理

2. **条件路由与依赖管理**
   - 航班查询 → 酒店查询 → 酒店选择 → 预订执行的强依赖关系
   - 每个步骤的成功与否决定后续流程的走向
   - 优雅的错误处理和用户反馈

3. **模块化节点设计**
   - 每个功能节点独立且可测试
   - 支持节点的灵活替换和扩展
   - 清晰的接口定义和数据流

### 关键技术选型

| 技术组件 | 选型理由 | 优势 |
|---------|---------|------|
| **LangGraph** | 图工作流管理 | 天然适合多步骤、有依赖的 Agent 流程 |
| **DeepSeek API** | 大语言模型服务 | 优秀的中文理解能力，成本效益高 |
| **TypedDict** | 状态类型定义 | 类型安全，开发体验好，便于调试 |
| **条件路由** | 流程控制 | 灵活处理各种执行路径和异常情况 |

### 为什么选择这种 Agent 类型？

本项目采用 **规划-执行型 Agent**，原因如下：

1. **复杂任务拆解需求**：旅行规划涉及多个相互依赖的子任务
2. **状态管理必要性**：需要维护中间结果（航班信息、酒店列表等）
3. **错误恢复能力**：某个步骤失败时能够提供有意义的反馈
4. **可解释性**：用户可以清晰看到每个步骤的执行情况

## 🛠 环境配置

### 系统要求

- Python 3.8+
- 稳定的网络连接
- DeepSeek API Key（或本地 Ollama 部署）

### 安装步骤

1. **克隆项目**
```bash
git clone https://github.com/BlueWhale7510/travel_agent
cd travel_agent
```

2. **创建虚拟环境**（推荐）
```bash
conda create -n travel_agent python=3.9
conda activate travel_agent
```

3. **安装依赖**
```bash
pip install -r requirements.txt
```

**注意：** Web 界面需要额外安装 Streamlit：
```bash
pip install streamlit
```

4. **配置 API Key**
   在 `travel_agent.py` 或 `travel_agent_web.py` 中设置你的 DeepSeek API Key：
```python
DEEPSEEK_API_KEY = "your-api-key-here"
```

### 可选：本地模型部署

如果你希望使用本地模型，可以安装 Ollama：

```bash
# 安装 Ollama
curl -fsSL https://ollama.ai/install.sh | sh

# 拉取模型
ollama pull deepseek-r1:1.5b

# 修改代码配置
USE_API = False
```

## 🚀 项目运行

### 方式一：Web 界面（推荐）

启动基于 Streamlit 的交互式 Web 界面：

```bash
streamlit run travel_agent_web.py
```

访问 `http://localhost:8501` 即可使用图形化界面进行旅行规划。

**Web 界面特色功能：**
- 🎨 直观的图形化界面
- 📊 实时进度条和状态显示
- 📋 详细的步骤信息展示
- 🎯 快速模板选择
- 💰 费用明细可视化
- 📝 完整的执行日志

### 方式二：命令行交互模式

```bash
python travel_agent.py
```

### 运行测试用例

```bash
# 如果需要运行测试，取消代码中 test_travel_agent() 的注释
```

## 📊 成果展示

### 核心功能演示

#### Web 界面演示

**启动 Web 界面：**
```bash
streamlit run travel_agent_web.py
```

**界面特色：**
- 🎨 直观的图形化界面，支持实时交互
- 📊 进度条显示当前执行步骤
- 📋 可展开的信息面板，详细展示每个步骤
- 🎯 快速模板按钮，一键填入常用需求
- 💰 费用明细可视化展示
- 📝 完整的执行日志记录

#### 示例 1：完整的旅行规划（Web 界面）
```
🎯 请输入您的旅行需求: 我想预订去北京的机票和酒店，住3晚，我叫张三

📍 步骤1: 提取用户需求信息...
🤖 DeepSeek 解析结果: {
    "destination": "北京",
    "travel_date": "2025-10-27",
    "nights": 3,
    "guest_name": "张三"
}

📍 步骤2: 查询前往 北京 的航班...
✅ 找到航班: CA123 (1200元)

📍 步骤3: 查询 北京 的酒店...
✅ 找到 3 家可用酒店

📍 步骤4: 选择酒店...
✅ 智能选择: 北京国贸大酒店

📍 步骤5: 执行预订操作...
✅ 预订成功! ID: BKCA123XXXXX
```

#### 示例 2：错误处理展示
```
🎯 请输入您的旅行需求: 帮我预订去巴黎的机票

❌ 抱歉，2025-10-27 前往 巴黎 的航班已售罄或暂无航班
💡 建议：尝试调整旅行日期或选择其他目的地
```

### 复现核心成果

#### 1. 多步骤规划能力
Agent 能够自动拆解复杂需求：
- 信息提取 → 航班查询 → 酒店查询 → 智能选择 → 最终预订

#### 2. 状态管理演示
```python
# 状态流转示例
state = {
    "destination": "北京",
    "travel_date": "2025-10-27", 
    "flights_result": {"flight_number": "CA123", "price": 1200},
    "hotels_result": [...],
    "selected_hotel": {...},
    "booking_result": {...}
}
```

#### 3. 依赖关系处理
- 强依赖：必须有航班才能查询酒店
- 事务性：航班和酒店都确认后才能预订
- 条件路由：基于前一步结果决定后续流程

#### 4. 智能错误恢复
- 航班查询失败 → 立即停止并给出建议
- 酒店查询失败 → 提供替代方案
- API 调用异常 → 降级到规则引擎

### 项目结构

```
travel_agent/
├── travel_agent.py          # 命令行版本主程序
├── travel_agent_web.py      # Web 界面版本（Streamlit）
├── requirements.txt         # 依赖列表
├── README.md               # 项目文档
├── check_installation.py   # 环境验证脚本
└── 项目图片/               # 项目截图和演示图片
    ├── langgraph1.png
    ├── langgraph2.png
    └── ...
```

### 关键特性

✅ **自然语言理解** - 使用 DeepSeek API 解析用户意图  
✅ **多步骤规划** - 自动拆解复杂任务为有序步骤  
✅ **状态管理** - 完整的执行状态跟踪和维护  
✅ **依赖处理** - 智能处理步骤间的依赖关系  
✅ **错误恢复** - 优雅的错误处理和用户指导  
✅ **智能决策** - 基于性价比自动选择最佳酒店  
✅ **双界面支持** - 命令行和 Web 界面两种交互方式  
✅ **实时可视化** - Web 界面提供进度条和状态展示  
✅ **快速模板** - 预设常用旅行场景模板  

## 🎨 扩展可能性

这个项目框架可以轻松扩展以下功能：

1. **多数据源集成**：接入真实的航班和酒店 API
2. **个性化推荐**：基于用户历史偏好进行推荐
3. **预算优化**：在给定预算内寻找最优方案
4. **行程规划**：添加景点推荐、交通安排等
5. **多模态交互**：支持图片、语音输入

## 🤝 贡献指南

欢迎提交 Issue 和 Pull Request 来改进这个项目！

## 📄 许可证

MIT License